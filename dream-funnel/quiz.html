<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rüya Analiz Testi | Astrobobo</title>
  <meta name="description" content="Rüyanızın derinliğini keşfedin.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://astrobobo.com/quiz">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0D0D1A 0%,#1A1A2E 100%);color:#F5F5F5;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}
    .container{max-width:480px;width:100%;background:rgba(255,255,255,0.03);border-radius:16px;padding:2rem;border:1px solid rgba(255,215,0,0.1)}
    h1{color:#FFD700;font-size:1.5rem;text-align:center;margin-bottom:0.5rem}
    .subtitle{color:#A0A0A0;text-align:center;font-size:0.9rem;margin-bottom:2rem}
    .question{margin-bottom:1.5rem}
    .question-title{font-size:1rem;margin-bottom:0.75rem;color:#E0E0E0}
    .options{display:flex;flex-direction:column;gap:0.5rem}
    .option{display:flex;align-items:center;padding:0.75rem 1rem;background:rgba(255,255,255,0.05);border-radius:8px;cursor:pointer;transition:all 0.2s;border:1px solid transparent}
    .option:hover{background:rgba(255,215,0,0.1);border-color:rgba(255,215,0,0.3)}
    .option input{display:none}
    .option.selected{background:rgba(255,215,0,0.15);border-color:#FFD700}
    .option-text{margin-left:0.5rem;font-size:0.95rem}
    .radio-circle{width:18px;height:18px;border:2px solid #666;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .option.selected .radio-circle{border-color:#FFD700}
    .option.selected .radio-circle::after{content:'';width:10px;height:10px;background:#FFD700;border-radius:50%}
    .btn{width:100%;padding:1rem;background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);color:#0D0D1A;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;margin-top:1rem;transition:transform 0.2s,opacity 0.2s}
    .btn:hover{transform:translateY(-2px)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .progress{display:flex;gap:0.5rem;margin-bottom:1.5rem}
    .progress-dot{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px}
    .progress-dot.active{background:#FFD700}
    .step{display:none}
    .step.active{display:block}
    .result{text-align:center;display:none}
    .result-icon{font-size:3rem;margin-bottom:1rem}
    .result-title{font-size:1.25rem;color:#FFD700;margin-bottom:0.5rem}
    .result-desc{color:#A0A0A0;font-size:0.95rem;line-height:1.5;margin-bottom:1.5rem}
    .cta-premium{background:linear-gradient(135deg,#9B59B6 0%,#8E44AD 100%);color:#fff}
    .cta-secondary{background:transparent;border:1px solid #666;color:#E0E0E0;margin-top:0.5rem}
    .cta-secondary:hover{border-color:#FFD700;color:#FFD700}
    .hidden{display:none}
    .price{font-size:1.5rem;color:#FFD700;font-weight:700;margin:1rem 0}
    .price-note{font-size:0.8rem;color:#888;margin-bottom:1rem}
    .offer-box{background:rgba(155,89,182,0.1);border:1px solid rgba(155,89,182,0.3);border-radius:12px;padding:1.5rem;margin:1rem 0}
    .offer-title{color:#C9B8FF;font-weight:600;margin-bottom:0.5rem}
    .disclaimer{font-size:0.75rem;color:#666;margin-top:1.5rem;line-height:1.4}
    .dream-input{width:100%;padding:1rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:1rem;resize:vertical;min-height:120px;margin-bottom:0.5rem}
    .dream-input::placeholder{color:#666}
    .dream-input:focus{outline:none;border-color:rgba(255,215,0,0.5)}
    .char-count{font-size:0.8rem;color:#666;text-align:right}
  </style>
</head>
<body>
  <div class="container">
    <div id="quiz-form">
      <h1>Rüyanı Analiz Edelim</h1>
      <p class="subtitle">Rüyanı anlat, 3 soruya cevap ver, yorumunu al</p>

      <div class="progress">
        <div class="progress-dot active" id="dot-0"></div>
        <div class="progress-dot" id="dot-1"></div>
        <div class="progress-dot" id="dot-2"></div>
        <div class="progress-dot" id="dot-3"></div>
      </div>

      <div class="step active" id="step-0">
        <div class="question">
          <div class="question-title">Rüyanı kısaca anlat</div>
          <textarea class="dream-input" id="dream-text" placeholder="Rüyamda bir ormanda yürüyordum..." maxlength="500"></textarea>
          <div class="char-count"><span id="char-count">0</span>/500</div>
        </div>
        <button class="btn" id="next-0" disabled>Devam Et</button>
      </div>

      <div class="step" id="step-1">
        <div class="question">
          <div class="question-title">Rüyanda baskın olan duygu hangisiydi?</div>
          <div class="options">
            <label class="option" data-value="fear">
              <input type="radio" name="emotion" value="fear">
              <div class="radio-circle"></div>
              <span class="option-text">Korku veya endise</span>
            </label>
            <label class="option" data-value="curiosity">
              <input type="radio" name="emotion" value="curiosity">
              <div class="radio-circle"></div>
              <span class="option-text">Merak veya saskinlik</span>
            </label>
            <label class="option" data-value="relief">
              <input type="radio" name="emotion" value="relief">
              <div class="radio-circle"></div>
              <span class="option-text">Rahatlama veya huzur</span>
            </label>
          </div>
        </div>
        <button class="btn" id="next-1" disabled>Devam Et</button>
      </div>

      <div class="step" id="step-2">
        <div class="question">
          <div class="question-title">Bu tarz rüyaları ne sıklıkla görüyorsun?</div>
          <div class="options">
            <label class="option" data-value="first">
              <input type="radio" name="frequency" value="first">
              <div class="radio-circle"></div>
              <span class="option-text">Ilk kez</span>
            </label>
            <label class="option" data-value="sometimes">
              <input type="radio" name="frequency" value="sometimes">
              <div class="radio-circle"></div>
              <span class="option-text">Ara sıra</span>
            </label>
            <label class="option" data-value="often">
              <input type="radio" name="frequency" value="often">
              <div class="radio-circle"></div>
              <span class="option-text">Sık sık</span>
            </label>
          </div>
        </div>
        <button class="btn" id="next-2" disabled>Devam Et</button>
      </div>

      <div class="step" id="step-3">
        <div class="question">
          <div class="question-title">Rüyandaki detayları ne kadar net hatırlıyorsun?</div>
          <div class="options">
            <label class="option" data-value="blurry">
              <input type="radio" name="clarity" value="blurry">
              <div class="radio-circle"></div>
              <span class="option-text">Bulanık, sadece ana tema</span>
            </label>
            <label class="option" data-value="mid">
              <input type="radio" name="clarity" value="mid">
              <div class="radio-circle"></div>
              <span class="option-text">Orta düzeyde</span>
            </label>
            <label class="option" data-value="clear">
              <input type="radio" name="clarity" value="clear">
              <div class="radio-circle"></div>
              <span class="option-text">Çok net, detaylı</span>
            </label>
          </div>
        </div>
        <button class="btn" id="submit-quiz" disabled>Sonucu Gör</button>
      </div>
    </div>

    <div class="result" id="result-low">
      <div class="result-title">Rüyan Keşfedilmeyi Bekliyor</div>
      <div class="result-desc">Bilinçaltın sana mesajlar gönderiyor. Kişisel yorumla derinlemesine keşfet.</div>
      <div class="offer-box">
        <div class="offer-title">Mini Kişisel Yorum</div>
        <p style="font-size:0.9rem;color:#ccc">Özet + ana sembol + öneri</p>
        <div class="price">$4.99</div>
        <button class="btn" onclick="checkout('mini')">Mini Yorum Al</button>
      </div>
      <button class="btn cta-secondary" onclick="checkout('full')">Detaylı Yorumu Gör ($9.99)</button>
    </div>

    <div class="result" id="result-mid">
      <div class="result-title">Ilginç Bir Rüya Deneyimin Var</div>
      <div class="result-desc">Tekrarlayan temalar ve net detaylar, bilinçaltının güçlü mesajlar taşıdığını gösteriyor.</div>
      <div class="offer-box">
        <div class="offer-title">Mini Kişisel Yorum</div>
        <p style="font-size:0.9rem;color:#ccc">Sembol analizi + kişisel içgörü</p>
        <div class="price">$4.99</div>
        <button class="btn" onclick="checkout('mini')">Mini Yorum Al</button>
      </div>
      <button class="btn cta-secondary" onclick="checkout('full')">Detaylı Yorum + PDF ($9.99)</button>
    </div>

    <div class="result" id="result-high">
      <div class="result-title">Güçlü Bir Rüya Mesajın Var</div>
      <div class="result-desc">Yoğun duygular, tekrarlayan temalar ve net detaylar... Bilinçaltın sana önemli bir şey anlatmaya çalışıyor.</div>
      <div class="offer-box">
        <div class="offer-title">Detaylı Kişisel Yorum + PDF</div>
        <p style="font-size:0.9rem;color:#ccc">Psikolojik + sembolik + ruhsal analiz</p>
        <div class="price">$9.99</div>
        <div class="price-note">PDF formatında sakla, istediğin zaman oku</div>
        <button class="btn cta-premium" onclick="checkout('full')">Detaylı Yorum Al</button>
      </div>
      <button class="btn cta-secondary" onclick="checkout('mini')">Mini Yorum ($4.99)</button>
    </div>

    <div class="disclaimer" id="disclaimer" style="display:none">
      Bu hizmet eğlence ve kişisel keşif amaçlıdır. Profesyonel psikolojik danışmanlık yerine geçmez.
    </div>
  </div>

  <script>
    (function(){
      var qt = crypto.randomUUID();
      var answers = {emotion:null,frequency:null,clarity:null};
      var dreamText = '';
      var segment = 'low';
      var currentStep = 0;

      function fireEvent(name, data) {
        if(typeof fbq !== 'undefined') fbq('trackCustom', name, data || {});
        if(typeof gtag !== 'undefined') gtag('event', name, data || {});
      }

      function calcSegment() {
        var score = 0;
        if(answers.emotion === 'fear') score += 2;
        else if(answers.emotion === 'curiosity') score += 1;
        if(answers.frequency === 'often') score += 2;
        else if(answers.frequency === 'sometimes') score += 1;
        if(answers.clarity === 'clear') score += 2;
        else if(answers.clarity === 'mid') score += 1;
        if(score >= 5) return 'high';
        if(score >= 3) return 'mid';
        return 'low';
      }

      function selectOption(step, value) {
        var stepEl = document.getElementById('step-' + step);
        stepEl.querySelectorAll('.option').forEach(function(opt) {
          opt.classList.toggle('selected', opt.dataset.value === value);
        });
        var btn = step < 3 ? document.getElementById('next-' + step) : document.getElementById('submit-quiz');
        btn.disabled = false;
      }

      var dreamInput = document.getElementById('dream-text');
      var charCount = document.getElementById('char-count');
      var nextBtn0 = document.getElementById('next-0');

      dreamInput.addEventListener('input', function() {
        dreamText = this.value.trim();
        charCount.textContent = this.value.length;
        nextBtn0.disabled = dreamText.length < 20;
      });

      document.querySelectorAll('.option').forEach(function(opt) {
        opt.addEventListener('click', function() {
          var input = this.querySelector('input');
          answers[input.name] = input.value;
          var step = input.name === 'emotion' ? 1 : (input.name === 'frequency' ? 2 : 3);
          selectOption(step, input.value);
        });
      });

      function goToStep(step) {
        document.querySelectorAll('.step').forEach(function(s){s.classList.remove('active')});
        document.getElementById('step-' + step).classList.add('active');
        for(var i = 0; i <= 3; i++) {
          document.getElementById('dot-' + i).classList.toggle('active', i <= step);
        }
        currentStep = step;
      }

      document.getElementById('next-0').addEventListener('click', function() {
        fireEvent('quiz_start', {qt: qt});
        goToStep(1);
      });

      document.getElementById('next-1').addEventListener('click', function() { goToStep(2); });
      document.getElementById('next-2').addEventListener('click', function() { goToStep(3); });

      document.getElementById('submit-quiz').addEventListener('click', function() {
        segment = calcSegment();

        var quizData = {
          qt: qt,
          dreamText: dreamText,
          answers: answers,
          segment: segment,
          createdAt: new Date().toISOString()
        };
        localStorage.setItem('quiz_' + qt, JSON.stringify(quizData));

        fireEvent('quiz_completed', {qt: qt, segment: segment});

        document.getElementById('quiz-form').style.display = 'none';
        document.getElementById('result-' + segment).style.display = 'block';
        document.getElementById('disclaimer').style.display = 'block';
      });

      window.checkout = function(variant) {
        fireEvent('checkout_intent', {qt: qt, variant: variant, segment: segment});

        // Save quiz data to server before checkout
        var quizData = JSON.parse(localStorage.getItem('quiz_' + qt) || '{}');
        fetch('/api/quiz/save', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(quizData)
        }).catch(function(){});

        var baseUrl = variant === 'full'
          ? 'https://astrobobo.gumroad.com/l/ruya-detayli'
          : 'https://astrobobo.gumroad.com/l/ruya-mini';

        var url = baseUrl + '?qt=' + qt;
        window.location.href = url;
      };
    })();
  </script>
</body>
</html>
